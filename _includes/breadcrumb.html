{% comment %}
  パンくずリストコンポーネント（自動階層生成版）
  使用方法: {% include breadcrumb.html %}
  
  URLパスを自動的に解析して、すべての階層を表示します。
  ファイル名部分は除外し、カテゴリ階層のみを表示します。
{% endcomment %}

{% if page.url != "/" %}
{% assign url_parts = page.url | split: '/' %}
{% assign breadcrumb_path = "" %}

<nav class="breadcrumb" aria-label="パンくずリスト">
  <div class="container">
    <ol class="breadcrumb-list">
      <!-- ホーム -->
      <li class="breadcrumb-item">
        <a href="{{ '/' | relative_url }}">
          <i class="fas fa-home"></i>
          <span>ホーム</span>
        </a>
      </li>
      
      <!-- 中間階層を動的に生成（ファイル名部分を除外） -->
      {% for part in url_parts %}
        {% if part != "" %}
          {% assign breadcrumb_path = breadcrumb_path | append: "/" | append: part %}
          
          <!-- 日付部分（年月日）とファイル名をスキップ -->
          {% assign is_date = false %}
          {% assign is_filename = false %}
          
          {% if part.size == 4 and part contains "20" %}
            {% assign is_date = true %}
          {% elsif part.size == 2 %}
            {% assign is_date = true %}
          {% elsif forloop.last %}
            {% assign is_filename = true %}
          {% endif %}
          
          {% unless is_date or is_filename %}
            <li class="breadcrumb-item">
              <a href="{{ breadcrumb_path | relative_url }}">
                {% case part %}
                  {% when "guide" %}ガイド
                  {% when "legal-profession" %}士業
                  {% when "inheritance-investigation" %}相続調査
                  {% when "case-study" %}事例研究
                  {% when "blog" %}ブログ
                  {% when "service" %}サービス
                  {% when "faq" %}よくある質問
                  {% else %}{{ part | replace: "-", " " | capitalize }}
                {% endcase %}
              </a>
            </li>
          {% endunless %}
        {% endif %}
      {% endfor %}
      
      <!-- 現在のページ -->
      <li class="breadcrumb-item active" aria-current="page">
        {{ page.title }}
      </li>
    </ol>
  </div>
</nav>

<!-- 構造化データ（JSON-LD） -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "@id": "{{ site.url }}{{ page.url | relative_url }}#breadcrumb",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "ホーム",
      "item": "{{ site.url }}"
    }
    {% assign position = 2 %}
    {% assign breadcrumb_path = "" %}
    {% for part in url_parts %}
      {% if part != "" %}
        {% assign breadcrumb_path = breadcrumb_path | append: "/" | append: part %}
        
        {% comment %}日付部分とファイル名をスキップ{% endcomment %}
        {% assign is_date = false %}
        {% assign is_filename = false %}
        
        {% if part.size == 4 and part contains "20" %}
          {% assign is_date = true %}
        {% elsif part.size == 2 %}
          {% assign is_date = true %}
        {% elsif forloop.last %}
          {% assign is_filename = true %}
        {% endif %}
        
        {% unless is_date or is_filename %}
          ,{
            "@type": "ListItem", 
            "position": {{ position }},
            "name": "{% case part %}{% when "guide" %}ガイド{% when "legal-profession" %}士業{% when "inheritance-investigation" %}相続調査{% when "case-study" %}事例研究{% when "blog" %}ブログ{% when "service" %}サービス{% when "faq" %}よくある質問{% else %}{{ part | replace: "-", " " | capitalize }}{% endcase %}",
            "item": "{{ site.url }}{{ breadcrumb_path }}"
          }
          {% assign position = position | plus: 1 %}
        {% endunless %}
      {% endif %}
    {% endfor %}
    ,{
      "@type": "ListItem",
      "position": {{ position }},
      "name": "{{ page.title }}",
      "item": "{{ site.url }}{{ page.url | relative_url }}"
    }
  ]
}
</script>
{% endif %}

