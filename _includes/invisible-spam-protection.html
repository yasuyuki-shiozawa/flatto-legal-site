<!-- é€æ˜ã‚¹ãƒ‘ãƒ å¯¾ç­–ã‚·ã‚¹ãƒ†ãƒ  - ãŠå®¢æ§˜ã«ã¯ä¸€åˆ‡è¦‹ãˆãªã„ -->
<style>
/* ãƒãƒ‹ãƒ¼ãƒãƒƒãƒˆ: ãƒœãƒƒãƒˆãŒè‡ªå‹•å…¥åŠ›ã™ã‚‹ãŒäººé–“ã«ã¯è¦‹ãˆãªã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ */
.honeypot-field {
    position: absolute !important;
    left: -9999px !important;
    width: 1px !important;
    height: 1px !important;
    opacity: 0 !important;
    pointer-events: none !important;
    tabindex: -1 !important;
}

/* ã‚¹ãƒ‘ãƒ å¯¾ç­–ã®çŠ¶æ…‹è¡¨ç¤ºï¼ˆé–‹ç™ºç’°å¢ƒã®ã¿ï¼‰ */
.spam-protection-status {
    display: none;
    position: fixed;
    bottom: 10px;
    right: 10px;
    background: rgba(0,0,0,0.8);
    color: white;
    padding: 5px 10px;
    border-radius: 5px;
    font-size: 12px;
    z-index: 9999;
}

/* localhostç’°å¢ƒã§ã®ã¿è¡¨ç¤º */
body[data-env="development"] .spam-protection-status {
    display: block;
}
</style>

<!-- ãƒãƒ‹ãƒ¼ãƒãƒƒãƒˆ: ãƒœãƒƒãƒˆãŒå…¥åŠ›ã™ã‚‹ãŒäººé–“ã«ã¯è¦‹ãˆãªã„ -->
<input type="text" name="website" class="honeypot-field" autocomplete="off" tabindex="-1">
<input type="email" name="email_confirm" class="honeypot-field" autocomplete="off" tabindex="-1">
<input type="text" name="company_url" class="honeypot-field" autocomplete="off" tabindex="-1">

<!-- é–‹ç™ºç’°å¢ƒã§ã®çŠ¶æ…‹è¡¨ç¤º -->
<div class="spam-protection-status" id="spamStatus">
    ğŸ›¡ï¸ ã‚¹ãƒ‘ãƒ å¯¾ç­–: å¾…æ©Ÿä¸­
</div>

<script>
(function() {
    'use strict';
    
    // é–‹ç™ºç’°å¢ƒã®æ¤œå‡º
    const isDevelopment = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
    if (isDevelopment) {
        document.body.setAttribute('data-env', 'development');
    }
    
    // ã‚¹ãƒ‘ãƒ å¯¾ç­–ã‚·ã‚¹ãƒ†ãƒ 
    const SpamProtection = {
        // åˆæœŸåŒ–æ™‚åˆ»
        initTime: Date.now(),
        
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡Œå‹•ã®è¿½è·¡
        userActivity: {
            mouseMovement: false,
            keyboardInput: false,
            scrollActivity: false,
            focusEvents: false
        },
        
        // åˆæœŸåŒ–
        init: function() {
            this.setupEventListeners();
            this.updateStatus('ğŸ›¡ï¸ ã‚¹ãƒ‘ãƒ å¯¾ç­–: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–');
        },
        
        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
        setupEventListeners: function() {
            // ãƒã‚¦ã‚¹ç§»å‹•ã®æ¤œå‡º
            document.addEventListener('mousemove', () => {
                this.userActivity.mouseMovement = true;
                this.updateStatus('ğŸ›¡ï¸ ãƒã‚¦ã‚¹æ“ä½œ: æ¤œå‡º');
            }, { once: true });
            
            // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å…¥åŠ›ã®æ¤œå‡º
            document.addEventListener('keydown', () => {
                this.userActivity.keyboardInput = true;
                this.updateStatus('ğŸ›¡ï¸ ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰: æ¤œå‡º');
            }, { once: true });
            
            // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã®æ¤œå‡º
            document.addEventListener('scroll', () => {
                this.userActivity.scrollActivity = true;
                this.updateStatus('ğŸ›¡ï¸ ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«: æ¤œå‡º');
            }, { once: true });
            
            // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆã®æ¤œå‡º
            document.addEventListener('focusin', () => {
                this.userActivity.focusEvents = true;
                this.updateStatus('ğŸ›¡ï¸ ãƒ•ã‚©ãƒ¼ã‚«ã‚¹: æ¤œå‡º');
            }, { once: true });
            
            // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã®æ¤œè¨¼
            this.setupFormValidation();
        },
        
        // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡æ¤œè¨¼ã®è¨­å®š
        setupFormValidation: function() {
            // å…¨ã¦ã®ãƒ•ã‚©ãƒ¼ãƒ ã«å¯¾ã—ã¦æ¤œè¨¼ã‚’è¿½åŠ 
            document.addEventListener('submit', (e) => {
                if (!this.validateSubmission(e.target)) {
                    e.preventDefault();
                    this.updateStatus('âŒ ã‚¹ãƒ‘ãƒ æ¤œå‡º: é€ä¿¡ãƒ–ãƒ­ãƒƒã‚¯');
                    
                    // é–‹ç™ºç’°å¢ƒã§ã®ã¿ã‚¢ãƒ©ãƒ¼ãƒˆè¡¨ç¤º
                    if (isDevelopment) {
                        alert('ã‚¹ãƒ‘ãƒ å¯¾ç­–ã«ã‚ˆã‚Šé€ä¿¡ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸï¼ˆé–‹ç™ºç’°å¢ƒã®ã¿ã®è¡¨ç¤ºï¼‰');
                    }
                    
                    return false;
                }
                this.updateStatus('âœ… æ­£å¸¸é€ä¿¡: è¨±å¯');
            });
        },
        
        // é€ä¿¡æ¤œè¨¼
        validateSubmission: function(form) {
            const now = Date.now();
            const timeSinceInit = now - this.initTime;
            
            // 1. ãƒãƒ‹ãƒ¼ãƒãƒƒãƒˆæ¤œè¨¼
            const honeypotFields = form.querySelectorAll('.honeypot-field');
            for (let field of honeypotFields) {
                if (field.value.trim() !== '') {
                    console.log('ã‚¹ãƒ‘ãƒ æ¤œå‡º: ãƒãƒ‹ãƒ¼ãƒãƒƒãƒˆå…¥åŠ›');
                    return false;
                }
            }
            
            // 2. æ™‚é–“ãƒ™ãƒ¼ã‚¹æ¤œè¨¼ï¼ˆ5ç§’æœªæº€ã¯ç–‘ã‚ã—ã„ï¼‰
            if (timeSinceInit < 5000) {
                console.log('ã‚¹ãƒ‘ãƒ æ¤œå‡º: é€ä¿¡ãŒæ—©ã™ãã‚‹');
                return false;
            }
            
            // 3. æ™‚é–“ãƒ™ãƒ¼ã‚¹æ¤œè¨¼ï¼ˆ30åˆ†ä»¥ä¸Šã¯ç–‘ã‚ã—ã„ï¼‰
            if (timeSinceInit > 1800000) { // 30åˆ†
                console.log('ã‚¹ãƒ‘ãƒ æ¤œå‡º: ã‚»ãƒƒã‚·ãƒ§ãƒ³æ™‚é–“ãŒé•·ã™ãã‚‹');
                return false;
            }
            
            // 4. ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡Œå‹•æ¤œè¨¼ï¼ˆæœ€ä½é™ã®äººé–“ã‚‰ã—ã„æ“ä½œï¼‰
            const activityCount = Object.values(this.userActivity).filter(Boolean).length;
            if (activityCount < 2) {
                console.log('ã‚¹ãƒ‘ãƒ æ¤œå‡º: äººé–“ã‚‰ã—ã„æ“ä½œãŒä¸è¶³');
                return false;
            }
            
            // 5. æ—¥æœ¬æ™‚é–“å¸¯æ¤œè¨¼ï¼ˆæ·±å¤œ2-6æ™‚ã¯è¦æ³¨æ„ï¼‰
            const hour = new Date().getHours();
            if (hour >= 2 && hour <= 6) {
                // æ·±å¤œæ™‚é–“å¸¯ã¯è¿½åŠ æ¤œè¨¼
                if (activityCount < 3) {
                    console.log('ã‚¹ãƒ‘ãƒ æ¤œå‡º: æ·±å¤œæ™‚é–“å¸¯ã§ã®ç–‘ã‚ã—ã„æ“ä½œ');
                    return false;
                }
            }
            
            return true;
        },
        
        // çŠ¶æ…‹è¡¨ç¤ºã®æ›´æ–°ï¼ˆé–‹ç™ºç’°å¢ƒã®ã¿ï¼‰
        updateStatus: function(message) {
            if (isDevelopment) {
                const statusElement = document.getElementById('spamStatus');
                if (statusElement) {
                    statusElement.textContent = message;
                }
            }
        }
    };
    
    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†å¾Œã«åˆæœŸåŒ–
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => SpamProtection.init());
    } else {
        SpamProtection.init();
    }
    
    // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«å…¬é–‹ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
    if (isDevelopment) {
        window.SpamProtection = SpamProtection;
    }
})();
</script>

