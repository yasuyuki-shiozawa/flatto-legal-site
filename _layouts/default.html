<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if page.title %}{{ page.title }} | {% endif %}{{ site.title }}</title>
    <meta name="description" content="{% if page.description %}{{ page.description }}{% else %}{{ site.description }}{% endif %}">
    
    <!-- SEO Keywords -->
    <meta name="keywords" content="{% if page.keywords %}{{ page.keywords }}{% else %}入札,公共調達,行政書士,入札制度,政府調達,地方自治体,競争入札,随意契約,プロポーザル,入札参加資格{% endif %}">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="{% if page.layout == 'post' %}article{% else %}website{% endif %}">
    <meta property="og:url" content="{{ page.url | absolute_url }}">
    <meta property="og:title" content="{% if page.title %}{{ page.title }} | {% endif %}{{ site.title }}">
    <meta property="og:description" content="{% if page.description %}{{ page.description }}{% else %}{{ site.description }}{% endif %}">
    <meta property="og:image" content="{{ '/assets/images/og-image.webp' | absolute_url }}">
    <meta property="og:site_name" content="{{ site.title }}">
    <meta property="og:locale" content="ja_JP">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="{{ page.url | absolute_url }}">
    <meta property="twitter:title" content="{% if page.title %}{{ page.title }} | {% endif %}{{ site.title }}">
    <meta property="twitter:description" content="{% if page.description %}{{ page.description }}{% else %}{{ site.description }}{% endif %}">    <meta property="twitter:image" content="{{ 
'/assets/images/og-image.webp' | absolute_url }}">
    
    <!-- Additional SEO -->
    <meta name="author" content="行政書士法人ふらっと法務事務所">
    <meta name="robots" content="index, follow">
    <meta name="google-site-verification" content="pm0dB5OZdlVLMG0oY-Ot2QBGvDZ2pNd3TA_MPUJF3ig" />
    <link rel="canonical" href="{{ page.url | absolute_url }}">
    
    <!-- SEO -->
    {% seo %}
    
    <!-- Enhanced SEO and Structured Data -->
    {% include seo-enhancements.html %}
    
    <!-- Performance Optimization -->
    {% include performance-optimization.html %}
    
    <!-- Critical CSS（インライン） -->
    <style>
    {% include critical.css %}
    </style>
    
    <!-- メインCSS（SCSSからコンパイル） -->
    <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}?v={{ site.time | date: '%s' }}">
    <!-- 緊急修正CSS（main.cssがコンパイルされない場合の代替） -->
    <link rel="stylesheet" href="{{ '/assets/css/emergency-fix.css' | relative_url }}?v={{ site.time | date: '%s' }}">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- 重要なリソースのプリロード -->
    <link rel="preload" href="/assets/images/logo.webp" as="image">
    <link rel="preload" href="/assets/images/hero-character.webp" as="image">    
    <!-- Google Analytics 4 (GA4) -->
    {% if site.google_analytics %}
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id={{ site.google_analytics }}"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', '{{ site.google_analytics }}');
    </script>
    {% endif %}
    
    <!-- Polyfill for rel=preload -->
    <script>
    /*! loadCSS rel=preload polyfill. [c]2017 Filament Group, Inc. MIT License */
    !function(e){"use strict";e.loadCSS||(e.loadCSS=function(){});var t=loadCSS.relpreload={};if(t.support=function(){var t;try{t=e.document.createElement("link").relList.supports("preload")}catch(e){t=!1}return function(){return t}}(),t.bindMediaToggle=function(e){var t=e.media||"all";function a(){e.addEventListener?e.removeEventListener("load",a):e.attachEvent&&e.detachEvent("onload",a),e.setAttribute("onload",null),e.media=t}e.addEventListener?e.addEventListener("load",a):e.attachEvent&&e.attachEvent("onload",a),setTimeout(function(){e.rel="stylesheet",e.media="only x"}),setTimeout(function(){e.media=t},0)},t.poly=function(){if(!t.support())for(var a=e.document.getElementsByTagName("link"),n=0;n<a.length;n++){var o=a[n];"preload"!==o.rel||"style"!==o.getAttribute("as")||o.getAttribute("data-loadcss")||(o.setAttribute("data-loadcss",!0),t.bindMediaToggle(o))}},!t.support()){t.poly();var a=e.setInterval(t.poly,500);e.addEventListener?e.addEventListener("load",function(){t.poly(),e.clearInterval(a)}):e.attachEvent&&e.attachEvent("onload",function(){t.poly(),e.clearInterval(a)})}"undefined"!=typeof exports?exports.loadCSS=loadCSS:e.loadCSS=loadCSS}("undefined"!=typeof global?global:this);
    </script>
</head>
<body data-page-url="{{ page.url }}" {% if page.body_class %}class="{{ page.body_class }}"{% endif %}>
    {% include header.html %}
    
    <!-- パンくずリスト -->
    {% include breadcrumb.html %}
    
    <main class="main-container">
        <div class="content-wrapper three-column">
            {% unless page.hide_left_sidebar %}
            <aside class="left-sidebar">
                {% include left-sidebar.html %}
            </aside>
            {% endunless %}
            
            <div class="main-content">
                {{ content }}
            </div>
            
            {% unless page.hide_right_sidebar %}
            <aside class="right-sidebar">
                {% include sidebar.html %}
            </aside>
            {% endunless %}
        </div>
    </main>
    
    {% include footer.html %}
    
    <!-- モバイルサイドバー -->
    {% include mobile-sidebar.html %}
    
    <!-- フローティングキャラクター -->
    <div class="floating-character" id="floatingCharacter">
        <img src="/assets/images/saori_character.webp" alt="お助けキャラクター さおり">
        <div class="character-bubble">
            何かお困りですか？<br>
            クリックで相談ページへ！
        </div>
    </div>
    
    <!-- フローティングCTA -->
    <div class="floating-cta">
        <a href="tel:0120-123-456" class="floating-cta-button">
            <i class="fas fa-phone"></i>
        </a>
        <div class="floating-cta-tooltip">
            お電話でのご相談はこちら
        </div>
    </div>
    
    <!-- スティッキーCTAバー -->
    <div class="sticky-cta-bar" id="stickyCTA">
        <div class="sticky-cta-content">
            <div class="sticky-cta-text">
                <h4>無料相談実施中！</h4>
                <p>入札参加の疑問や不安を解消します</p>
            </div>
            <div class="sticky-cta-actions">
                <a href="/contact/" class="cta-button cta-primary">
                    <i class="fas fa-envelope"></i>
                    メールで相談
                </a>
                <a href="tel:0120-123-456" class="cta-button cta-secondary">
                    <i class="fas fa-phone"></i>
                    電話で相談
                </a>
            </div>
        </div>
    </div>
    
    <!-- 条件付きスクリプト読み込み -->
    {% if page.use_toc %}
    <!-- 目次機能 -->
    <script src="{{ '/assets/js/optimized/toc.js' | relative_url }}?v=20250613_01" defer></script>
    {% endif %}
    
    {% if page.use_search %}
    <!-- Lunr.js検索ライブラリ -->
    <script src="https://unpkg.com/lunr/lunr.min.js" defer></script>
    <!-- 検索機能 -->
    <script src="{{ '/assets/js/optimized/search.js' | relative_url }}?v=20250613_01" defer></script>
    {% endif %}
    
    <!-- 検索オーバーレイ -->
    {% include search-overlay.html %}
    
    <!-- Google Tag Manager (noscript) -->
    {% if site.google_tag_manager %}
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id={{ site.google_tag_manager }}"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    {% endif %}
    
    <!-- 画像遅延読み込みスクリプト -->
    <script>
        // 画像の遅延読み込み
        document.addEventListener('DOMContentLoaded', function() {
            const images = document.querySelectorAll('img:not([loading])');
            images.forEach(img => {
                // ヒーロー画像やロゴなど重要な画像は除外
                if (!img.classList.contains('hero-img') && 
                    !img.classList.contains('logo-img') && 
                    !img.src.includes('logo.webp')) {
                    img.setAttribute('loading', 'lazy');
                }
            });
        });
    </script>
    
    <!-- 統合JavaScript（遅延読み込み） -->
    <script src="{{ '/assets/js/main.js' | relative_url }}?v={{ site.time | date: '%s' }}" defer></script>
    
    <!-- Service Worker登録 -->
    <script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
            navigator.serviceWorker.register('/sw.js')
                .then(function(registration) {
                    console.log('Service Worker registered');
                })
                .catch(function(error) {
                    console.log('Service Worker registration failed:', error);
                });
        });
    }
    </script>
</body>
</html>


